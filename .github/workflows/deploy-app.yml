name: Deploy App to GKE

on:
  push:
    paths:
      - 'K8s/**'

jobs:
  deploy:
    runs-on: self-hosted
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    - name: Set up gcloud SDK
      uses: google-github-actions/setup-gcloud@v2
      with:
          project_id: your-project-id
          export_default_credentials: true
    - name: Setup GKE Auth
      run: |
        echo '${{ secrets.GCP_SA_KEY }}' > key.json
        gcloud auth activate-service-account --key-file=key.json
        gcloud config set project ${{ secrets.GCP_PROJECT }}
        gcloud config set compute/region ${{ secrets.GCP_REGION }}
        gcloud container clusters get-credentials github-gke-cluster --region=${{ secrets.GCP_REGION }}
        gcloud container clusters get-credentials github-gke-cluster --zone ${{ secrets.GCP_ZONE }} --project=${{ secrets.GCP_PROJECT }}rim-mote-464705-a0

    - name: Deploy App
      run: kubectl apply -f k8s/
